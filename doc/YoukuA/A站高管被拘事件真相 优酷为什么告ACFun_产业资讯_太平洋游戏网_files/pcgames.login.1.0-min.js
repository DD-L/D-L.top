/*!svn:http://zzsvn.pcauto.com.cn/svn/data/pcgames/commom/js/pcgames.login.1.0.js*/
(function(h,k){function l(b,a){return new i(b,a);}var j=/^#([\w-]+)$|^(\w+)$|^\.([\w-]+)$/,m=/\?/;String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"");};function i(e,r){if(!e){return this;}var c;this.elements=[];if(typeof e==="string"){r=r?(r.ownerDocument?r:document):document;c=j.exec(e);if(c[1]){var f=r.getElementById(c[1]);if(f){this.elements.push(f);}}if(c[2]){var s=r.getElementsByTagName(c[2]);this.elements=s;}if(c[3]){var e=c[3],g=new RegExp("\\b"+e+"\\b");var s=[];if(document.getElementsByClassName){s=r.getElementsByClassName(e);}else{var a=r.getElementsByTagName("*");for(var d=0,b=a.length;d<b;d++){if(g.test(a[d].className)){s.push(a[d]);}}}this.elements=s;}}else{this.elements.push(e);}this[0]=this.elements[0];}i.prototype={each:function(a){var c=this.elements;for(var b=0,d=c.length;b<d;b++){a.call(c[b],b,c[b]);}return this;},hide:function(){return this.each(function(){this.style.display="none";});},show:function(){return this.each(function(){this.style.display="block";});},addClass:function(a){return this.each(function(){var c=this.className,b=new RegExp("\\b"+a+"\\b","g");if(!b.test(c)){this.className=(c+" "+a).trim();}});},removeClass:function(a){return this.each(function(){var c=this.className,b=new RegExp(a+"\\b\\s?","g");c=c.replace(b,"");this.className=c.trim();});},bind:function(a,b){var c=a;if(!("on"+a in document.body)){if(a=="mouseenter"){c="mouseover";}if(a=="mouseleave"){c="mouseout";}}return this.each(function(){var d=this;b.eventHandler=function(f){var f=f||h.event;f.target=f.target||f.srcElement;if(a=="mouseenter"||a=="mouseleave"){if("on"+a in document.body){b.call(d,f);}else{var e=l.event.getRelatedTarget(f);if(e!=d&&!l.contains(d,e)){b.call(d,f);}}}else{b.call(d,f);}};if(this.addEventListener){this.addEventListener(c,b.eventHandler,false);}else{this.attachEvent("on"+c,b.eventHandler);}});},unbind:function(a,b){var c=a;if(!("on"+a in document.body)){if(a=="mouseenter"){c="mouseover";}if(a=="mouseleave"){c="mouseout";}}return this.each(function(){if(this.removeEventListener){this.removeEventListener(c,b.eventHandler,false);}else{this.detachEvent("on"+c,b.eventHandler);}});}};l.contains=document.compareDocumentPosition?function(a,b){return !!(a.compareDocumentPosition(b)&16);}:function(a,b){return a!==b&&(a.contains?a.contains(b):true);};l.event={getRelatedTarget:function(a,b){if(a.relatedTarget){return a.relatedTarget;}else{if(a.type=="mouseover"){return a.fromElement;}else{if(a.type=="mouseout"){return a.toElement;}else{return null;}}}}};l.getJSONP=function(d){var e=d.url,c=+new Date(),a=d.charset||"",b=d.jsonpCallback||"xm"+c+Math.floor(Math.random()*1000);e+=(m.test(e)?"&":"?")+(d.jsonp||"callback")+"="+b;h[b]=h[b]||function(f){arguments.callee.cacheData=f;setTimeout(function(){h[b]=k;try{delete h[b];}catch(g){}},5000);};l.getScript(e,function(){d.success(h[b].cacheData);},a);};l.getScript=function(c,a,b){var d=document.createElement("script");if(b){d.charset=b;}d.src=c;d.onload=d.onreadystatechange=function(){if(!d.readyState||d.readyState=="loaded"||d.readyState=="complete"){d.onload=d.onreadystatechange=null;a();}};document.getElementsByTagName("head")[0].appendChild(d);};var n=false;l.isReady=false;l.readyList=[];l.ready=function(a){l.bindReady();if(l.isReady){a();}else{if(l.readyList){l.readyList.push(a);}}};l.bindReady=function(){if(n){return;}n=true;if(document.readyState==="complete"){return a();}if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);a();},false);h.addEventListener("load",a,false);}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);a();}});h.attachEvent("onload",a);}}function a(){if(!l.isReady){if(!document.body){return setTimeout(a,13);}l.isReady=true;var b=l.readyList,d=b.length;for(var c=0;c<b.length;c++){b[c]();}}}};h.xm=l;})(window);(function(){function h(a,b,d){if(d===undefined){d=true;}for(var c in b){if(d||!(c in a)){a[c]=b[c];}}}var f={path:"",domain:"",secure:false};function j(c,d,a){a=a||{};h(a,f,false);if(d===null){a.expires=-1;}var q=a.expires,b=a.path,p=a.domain,r=a.secure;if(typeof q==="number"){var e=q;q=new Date();q.setDate(q.getDate()+e);}var o=[encodeURIComponent(c),"=",encodeURIComponent(d),q?"; expires="+q.toUTCString():"",b?"; path="+b:"",p?"; domain="+p:"",r?"; secure":""].join("");document.cookie=o;return o;}function i(a){return(new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie);}function g(a){if(!a||!i(a)){return null;}var b=document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1");return decodeURIComponent(b);}window.Cookie={set:j,get:g,has:i};})();(function(b){var a={},c={};b.checkLogin=function(){var e={};e.state=false;e.cmu="";if(!!document.cookie.match(/(^|; )common_session_id=[^;]+/)){e.cmu=document.cookie.match(/(^|; )cmu=([^;]+)/)[2];e.state=true;}return e;};b.exitLogin=function(){var e=document.createElement("div");e.style.display="none";e.innerHTML='<iframe src="http://passport3.pcgames.com.cn/passport3/passport/logout_b.jsp" id="cross_frm" name="cross_frm" onload=" window.location.reload();" width="0" height="0"></iframe>';xm("#ajaxLogon")[0].parentNode.appendChild(e);};b.getUserData=function(e){if(a.data){e(a.data);}else{if(a.queue){a.queue.push(e);}else{a.queue=[e];xm.getJSONP({url:"http://my.pcgames.com.cn/intf/getLogedUser.jsp",jsonpCallback:"jsonp_getUserData",charset:"GBK",success:function(f){a.data=f;d(a.queue,b,f);delete a.queue;}});}}};b.getMessage=function(e){if(c.data){e(c.data);}else{if(c.queue){c.queue.push(e);}else{c.queue=[e];xm.getJSONP({url:"http://bip.pcgames.com.cn/intf/message.jsp?act=getNumToJson&siteId=3",jsonpCallback:"jsonp_getMessage",charset:"GBK",success:function(f){c.data=f;d(c.queue,b,f);delete c.queue;}});}}};b.getHeadPic=function(e,f){this.getUserData(function(m){var n=""+m.id;var j=[],k=0,g=n.length;while(k+2<=g){j.push(n.slice(k,k+2));k+=2;}if(k<g){j.push(n.charAt(k));}var h="http://i1.3conline.com/images/upload/upc/face/"+j.join("/")+"/"+n+"_"+e+"x"+e;f(h);});};b.getVisitedForums=function(e){xm.getJSONP({url:"http://bbs.pcgames.com.cn/util/visited_forum_list.jsp?type=json&fids="+Cookie.get("visitedfid"),jsonpCallback:"jsonp_getVisitedForums",charset:"GBK",success:function(f){e(f);}});};b.getFavForums=function(e){this.getUserData(function(f){xm.getJSONP({url:"http://bbs.pcgames.com.cn/intf/user/_favForums.jsp?userId="+f.id,jsonpCallback:"jsonp_getFavForums",charset:"GBK",success:function(g){e(g);}});});};d(b.queue,b);delete b.url;delete b.queue;function d(f,j,g){for(var h=0,e=f.length;h<e;h++){f[h].call(b,g);}}})(ajaxLogin||{});(function(){if(!document.getElementById("ajaxLogon")){return;}xm(".Jnb-tit",xm("#navibar")[0]).bind("mouseenter",function(){xm(this).addClass("nb-tit-hover");}).bind("mouseleave",function(){xm(this).removeClass("nb-tit-hover");});xm("#Jlogin-tit").bind("mouseenter",function(){if(!this.isHover){xm("a",this).each(function(){this.href=this.href+escape(location.href);});this.isHover=true;}});var a=ajaxLogin.checkLogin();if(a.state==true){ajaxLogin.getUserData(function(d){var c=d.id,b;if(typeof d!="object"||d.nickName==a.cmu){b=a.cmu;}else{b=d.nickName;}xm("#ajaxLogon")[0].innerHTML=xm("#JloginOnHtml")[0].innerHTML;ajaxLogin.getHeadPic(20,function(e){xm("#JuserHeadPic")[0].src=e;});xm("#Jnb-nick")[0].href="http://my.pcgames.com.cn/"+c+"/";xm("#JuserName")[0].innerHTML=b;xm("#Jnb-tit-user").bind("mouseenter",function(){xm(this).addClass("nb-tit-hover");}).bind("mouseleave",function(){xm(this).removeClass("nb-tit-hover");});ajaxLogin.getMessage(function(e){if(e.code==-1){return;}var f=e.messageCount+e.systemNoticeCount+e.forumReplyCount;if(f>0){xm("#Jnb-msgNum")[0].innerHTML=f;xm("#Jnb-msgNum")[0].className="nb-message-num";xm("#ajaxLogon").addClass("nb-info-msg");}});});}xm("#Jnb-tit-bbs").bind("mouseenter",function(){if(a.bbsStatus){return;}ajaxLogin.getVisitedForums(function(e){var d="",b=e.length,c=0;if(b===0){d='<span class="nb-ml-item">暂无记录</span>';}else{for(;c<b&&c<4;c++){d+='<a class="nb-ml-item" href="'+e[c].url+'" target="_blank" title="'+e[c].name+'">'+e[c].name+"</a>";}}xm("#Jnb-bbs-visit")[0].innerHTML=d;});a.state&&ajaxLogin.getFavForums(function(e){if(e.error){return;}var c=e.list,d=0,b=c.length,f="";if(b==0){f='<span class="nb-ml-item">暂无收藏</span>';}else{for(;d<b&&d<4;d++){f+='<a class="nb-ml-item" href="'+c[d].url+'" target="_blank" title="'+c[d].name+'">'+c[d].name+"</a>";}}xm("#Jnb-bbs-goindex")[0].style.display="none";xm("#Jnb-bbs-favb")[0].style.display="block";xm("#Jnb-bbs-favl")[0].innerHTML=f;});a.bbsStatus=true;});})(window);